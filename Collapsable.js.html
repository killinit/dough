<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: components/Collapsable.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"default":{"outputSourceFiles":true},"monospaceLinks":false,"cleverLinks":true,"applicationName":"Dough JavaScript","copyright":"Copyright Money Advice Service &copy;","linenums":true,"collapseSymbols":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Dough JavaScript</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="module:Collapsable~Collapsable">
            <span class="title">
                <a href="module-Collapsable-Collapsable.html">module:Collapsable~Collapsable</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:Collapsable~Collapsable#_setupAccessibility"><a href="module-Collapsable-Collapsable.html#_setupAccessibility">_setupAccessibility</a></li>
            
                <li data-name="module:Collapsable~Collapsable#handleUIEventTracking"><a href="module-Collapsable-Collapsable.html#handleUIEventTracking">handleUIEventTracking</a></li>
            
                <li data-name="module:Collapsable~Collapsable#init"><a href="module-Collapsable-Collapsable.html#init">init</a></li>
            
                <li data-name="module:Collapsable~Collapsable#setListeners"><a href="module-Collapsable-Collapsable.html#setListeners">setListeners</a></li>
            
                <li data-name="module:Collapsable~Collapsable#setTargetTrackingListeners"><a href="module-Collapsable-Collapsable.html#setTargetTrackingListeners">setTargetTrackingListeners</a></li>
            
                <li data-name="module:Collapsable~Collapsable#toggle"><a href="module-Collapsable-Collapsable.html#toggle">toggle</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="module:DoughBaseComponent~DoughBaseComponent">
            <span class="title">
                <a href="module-DoughBaseComponent-DoughBaseComponent.html">module:DoughBaseComponent~DoughBaseComponent</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent.extend"><a href="module-DoughBaseComponent-DoughBaseComponent.html#extend">extend</a></li>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent#_bindUiEvents"><a href="module-DoughBaseComponent-DoughBaseComponent.html#_bindUiEvents">_bindUiEvents</a></li>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent#_initialisedFailure"><a href="module-DoughBaseComponent-DoughBaseComponent.html#_initialisedFailure">_initialisedFailure</a></li>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent#_initialisedSuccess"><a href="module-DoughBaseComponent-DoughBaseComponent.html#_initialisedSuccess">_initialisedSuccess</a></li>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent#_unbindUiEvents"><a href="module-DoughBaseComponent-DoughBaseComponent.html#_unbindUiEvents">_unbindUiEvents</a></li>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent#destroy"><a href="module-DoughBaseComponent-DoughBaseComponent.html#destroy">destroy</a></li>
            
                <li data-name="module:DoughBaseComponent~DoughBaseComponent#setElement"><a href="module-DoughBaseComponent-DoughBaseComponent.html#setElement">setElement</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="module:FieldHelpText~FieldHelpText">
            <span class="title">
                <a href="module-FieldHelpText-FieldHelpText.html">module:FieldHelpText~FieldHelpText</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:FieldHelpText~FieldHelpText#_addAccessibility"><a href="module-FieldHelpText-FieldHelpText.html#_addAccessibility">_addAccessibility</a></li>
            
                <li data-name="module:FieldHelpText~FieldHelpText#_addListeners"><a href="module-FieldHelpText-FieldHelpText.html#_addListeners">_addListeners</a></li>
            
                <li data-name="module:FieldHelpText~FieldHelpText#_onBlur"><a href="module-FieldHelpText-FieldHelpText.html#_onBlur">_onBlur</a></li>
            
                <li data-name="module:FieldHelpText~FieldHelpText#hideTooltip"><a href="module-FieldHelpText-FieldHelpText.html#hideTooltip">hideTooltip</a></li>
            
                <li data-name="module:FieldHelpText~FieldHelpText#init"><a href="module-FieldHelpText-FieldHelpText.html#init">init</a></li>
            
                <li data-name="module:FieldHelpText~FieldHelpText#showTooltip"><a href="module-FieldHelpText-FieldHelpText.html#showTooltip">showTooltip</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="module:RangeInput~RangeInput">
            <span class="title">
                <a href="module-RangeInput-RangeInput.html">module:RangeInput~RangeInput</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:RangeInput~RangeInput#_cloneElements"><a href="module-RangeInput-RangeInput.html#_cloneElements">_cloneElements</a></li>
            
                <li data-name="module:RangeInput~RangeInput#_setupSyncInputs"><a href="module-RangeInput-RangeInput.html#_setupSyncInputs">_setupSyncInputs</a></li>
            
                <li data-name="module:RangeInput~RangeInput#init"><a href="module-RangeInput-RangeInput.html#init">init</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="module:TabSelector~TabSelector">
            <span class="title">
                <a href="module-TabSelector-TabSelector.html">module:TabSelector~TabSelector</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:TabSelector~TabSelector#_checkComponentMarkup"><a href="module-TabSelector-TabSelector.html#_checkComponentMarkup">_checkComponentMarkup</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_convertLinksToButtons"><a href="module-TabSelector-TabSelector.html#_convertLinksToButtons">_convertLinksToButtons</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_deSelectItem"><a href="module-TabSelector-TabSelector.html#_deSelectItem">_deSelectItem</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_focusTarget"><a href="module-TabSelector-TabSelector.html#_focusTarget">_focusTarget</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_handleClickEvent"><a href="module-TabSelector-TabSelector.html#_handleClickEvent">_handleClickEvent</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_haveTriggersWrapped"><a href="module-TabSelector-TabSelector.html#_haveTriggersWrapped">_haveTriggersWrapped</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_positionMenu"><a href="module-TabSelector-TabSelector.html#_positionMenu">_positionMenu</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_setTriggerWrapperHeight"><a href="module-TabSelector-TabSelector.html#_setTriggerWrapperHeight">_setTriggerWrapperHeight</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_setupAccessibility"><a href="module-TabSelector-TabSelector.html#_setupAccessibility">_setupAccessibility</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_subscribeHubEvents"><a href="module-TabSelector-TabSelector.html#_subscribeHubEvents">_subscribeHubEvents</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_toggleMenu"><a href="module-TabSelector-TabSelector.html#_toggleMenu">_toggleMenu</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_updateCollapsedState"><a href="module-TabSelector-TabSelector.html#_updateCollapsedState">_updateCollapsedState</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_updateTargets"><a href="module-TabSelector-TabSelector.html#_updateTargets">_updateTargets</a></li>
            
                <li data-name="module:TabSelector~TabSelector#_updateTriggers"><a href="module-TabSelector-TabSelector.html#_updateTriggers">_updateTriggers</a></li>
            
                <li data-name="module:TabSelector~TabSelector#init"><a href="module-TabSelector-TabSelector.html#init">init</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="module:TabularTooltip~TabularTooltip">
            <span class="title">
                <a href="module-TabularTooltip-TabularTooltip.html">module:TabularTooltip~TabularTooltip</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:TabularTooltip~TabularTooltip#init"><a href="module-TabularTooltip-TabularTooltip.html#init">init</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="module:Validation~Validation">
            <span class="title">
                <a href="module-Validation-Validation.html">module:Validation~Validation</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="module:Validation~Validation#_addAccessibility"><a href="module-Validation-Validation.html#_addAccessibility">_addAccessibility</a></li>
            
                <li data-name="module:Validation~Validation#_getErrorIndexByName"><a href="module-Validation-Validation.html#_getErrorIndexByName">_getErrorIndexByName</a></li>
            
                <li data-name="module:Validation~Validation#_getFieldGroup"><a href="module-Validation-Validation.html#_getFieldGroup">_getFieldGroup</a></li>
            
                <li data-name="module:Validation~Validation#_getFieldGroupValidity"><a href="module-Validation-Validation.html#_getFieldGroupValidity">_getFieldGroupValidity</a></li>
            
                <li data-name="module:Validation~Validation#_getInlineErrorID"><a href="module-Validation-Validation.html#_getInlineErrorID">_getInlineErrorID</a></li>
            
                <li data-name="module:Validation~Validation#_handleBlurEvent"><a href="module-Validation-Validation.html#_handleBlurEvent">_handleBlurEvent</a></li>
            
                <li data-name="module:Validation~Validation#_handleChangeEvent"><a href="module-Validation-Validation.html#_handleChangeEvent">_handleChangeEvent</a></li>
            
                <li data-name="module:Validation~Validation#_handleSubmit"><a href="module-Validation-Validation.html#_handleSubmit">_handleSubmit</a></li>
            
                <li data-name="module:Validation~Validation#_hideValidationSummary"><a href="module-Validation-Validation.html#_hideValidationSummary">_hideValidationSummary</a></li>
            
                <li data-name="module:Validation~Validation#_prepareFieldGroupValidity"><a href="module-Validation-Validation.html#_prepareFieldGroupValidity">_prepareFieldGroupValidity</a></li>
            
                <li data-name="module:Validation~Validation#_prepareMarkup"><a href="module-Validation-Validation.html#_prepareMarkup">_prepareMarkup</a></li>
            
                <li data-name="module:Validation~Validation#_removeAccessibility"><a href="module-Validation-Validation.html#_removeAccessibility">_removeAccessibility</a></li>
            
                <li data-name="module:Validation~Validation#_showValidationSummary"><a href="module-Validation-Validation.html#_showValidationSummary">_showValidationSummary</a></li>
            
                <li data-name="module:Validation~Validation#_sortErrorsByFieldDisplayOrder"><a href="module-Validation-Validation.html#_sortErrorsByFieldDisplayOrder">_sortErrorsByFieldDisplayOrder</a></li>
            
                <li data-name="module:Validation~Validation#_validateMax"><a href="module-Validation-Validation.html#_validateMax">_validateMax</a></li>
            
                <li data-name="module:Validation~Validation#_validateMin"><a href="module-Validation-Validation.html#_validateMin">_validateMin</a></li>
            
                <li data-name="module:Validation~Validation#_validateMinLength"><a href="module-Validation-Validation.html#_validateMinLength">_validateMinLength</a></li>
            
                <li data-name="module:Validation~Validation#_validatePattern"><a href="module-Validation-Validation.html#_validatePattern">_validatePattern</a></li>
            
                <li data-name="module:Validation~Validation#_validateRequired"><a href="module-Validation-Validation.html#_validateRequired">_validateRequired</a></li>
            
                <li data-name="module:Validation~Validation#addError"><a href="module-Validation-Validation.html#addError">addError</a></li>
            
                <li data-name="module:Validation~Validation#checkfieldGroupValidity"><a href="module-Validation-Validation.html#checkfieldGroupValidity">checkfieldGroupValidity</a></li>
            
                <li data-name="module:Validation~Validation#refreshInlineErrors"><a href="module-Validation-Validation.html#refreshInlineErrors">refreshInlineErrors</a></li>
            
                <li data-name="module:Validation~Validation#refreshValidationSummary"><a href="module-Validation-Validation.html#refreshValidationSummary">refreshValidationSummary</a></li>
            
                <li data-name="module:Validation~Validation#removeError"><a href="module-Validation-Validation.html#removeError">removeError</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="Collapsable.js.html">Source: components/Collapsable.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * # Element visibility toggler.
 *
 * Requires an element to have a `data-dough-component="Collapsable"` attribute. The application
 * file will spawn an instance of this class for each element it finds on the page.
 *
 * Events used: `toggler:toggled(element, isShown)` (Event for when the toggler is doing its work)
 *
 * See test fixture for sample markup - _spec/js/fixtures/Collapsable.html_
 *
 * @module Collapsable
 * @returns {class} Collapsable
 */

define(['jquery', 'DoughBaseComponent', 'eventsWithPromises'], function($, DoughBaseComponent, eventsWithPromises) {
  'use strict';

  // Class variables
  var defaultConfig = {
        hideOnBlur: false,
        forceTo: false,
        focusTarget: true,
        selectors: {
          trigger: '[data-dough-collapsable-trigger]',
          activeClass: 'is-active',
          inactiveClass: 'is-inactive',
          iconClassOpen: 'icon--down-chevron-blue',
          iconClassClose: 'icon--up-chevron-blue'
        },
        i18nStrings: {
          open: 'Show',
          close: 'Hide'
        }
      },
			Collapsable;

  /**
   * @constructor
   * @extends {DoughBaseComponent}
   * @param {object} $el - Trigger element (jQuery element)
   * @param {object} [config]
   * @returns {FieldHelpText}
   */
  Collapsable = function($el, config) {
    Collapsable.baseConstructor.call(this, $el, config, defaultConfig);
    this.$triggers = this.$el.is(this.config.selectors.trigger)? this.$el : this.$el.find(this.config.selectors.trigger);
    this.$target = $('[data-dough-collapsable-target="' + this.$triggers.attr('data-dough-collapsable-trigger') + '"]');
    this._setupAccessibility();
    this.handleUIEventTracking = $.proxy(this.handleUIEventTracking, this);
    config &amp;&amp; config.forceTo &amp;&amp; this.toggle(config.forceTo, false);
    return this;
  };

  /**
   * Inherit from base module, for shared methods and interface
   */
  DoughBaseComponent.extend(Collapsable);

  /**
   * Setups accessibility functionality for trigger and target buttons
   */
  Collapsable.prototype._setupAccessibility = function() {
    var id = 'data-dough-collapsable-target-' + this.$target.attr('data-dough-collapsable-target');

    this.$triggers.wrapInner('&lt;button class="unstyled-button" type="button"/>');
    this.$triggers.find('button')
        .prepend('&lt;span data-dough-collapsable-icon class="collapsable__trigger-icon icon ' +
            this.config.selectors.iconClassOpen + '">&lt;/span>')
        .append('&lt;span class="visually-hidden" data-dough-collapsable-label>' +
            this.config.i18nStrings.open + '&lt;/span>')
        .attr('aria-controls', id)
        .attr('aria-expanded', 'false');
    this.$target.attr('id', id);
    this.$triggers = this.$triggers.find('button');
  };

  /**
   * Initialises component
   * @param {object} initialised Promise passed from eventsWithPromises (RSVP Promise).
   * @returns {Collapsable}
   * @public
   */
  Collapsable.prototype.init = function(initialised) {
    // is the target element visible already
    this.isShown = !!this.$target.hasClass(this.config.selectors.activeClass);
    this.setListeners(true);
    this._initialisedSuccess(initialised);

    return this;
  };

  /**
   * Bind or unbind relevant DOM events on the trigger
   * @param {boolean} [isActive] Set to 'true' to bind to events, 'false' to unbind.
   * @public
   */
  Collapsable.prototype.setListeners = function(isActive) {
    this.$triggers[isActive ? 'on' : ' off']('click', $.proxy(function() {
      this.toggle();
    }, this));

    return this;
  };

  /**
   * Sets up the target tracking
   * @param {boolean} [isActive] Set to `true` to bind to events, `false` to unbind.
   * @public
   */
  Collapsable.prototype.setTargetTrackingListeners = function(isActive) {
    $('body')[isActive ? 'on' : 'off']('click touchend keyup', this.handleUIEventTracking);

    return this;
  };

  /**
   * Handler function for tracking event targets
   * Checks if trigger element is focussed, if the focus is within the target
   * @param  {object} e The event object for the current target
   * @public
   * @returns {Collapsable}
   */
  Collapsable.prototype.handleUIEventTracking = function(e) {
    var $currentTarget = $(e.target);
    if (!$currentTarget.is(this.$triggers) &amp;&amp; !$currentTarget.closest(this.$target).length) {
      this.toggle('hide');
    }

    return this;
  };

  /**
   * Toggle the element
   * @param  {string} [forceTo=show|hide] - explicitly toggle the element (set automatically by default).
   * @param {boolean} [focusTarget] - whether to focus the panel. Defaults to `config.focusTarget`
   * @returns {Collapsable}
   */
  Collapsable.prototype.toggle = function(forceTo, focusTarget) {
    var func,
        label,
        expandedLabel,
        iconClass;

    // is there an override parameter?
    if (typeof forceTo !== 'undefined') {
      func = forceTo === 'show' ? 'addClass' : 'removeClass';
    } else {
      func = this.isShown ? 'removeClass' : 'addClass';
    }


    // toggle the element
    this.isShown = !!this.$target[func](this.config.selectors.activeClass).hasClass(this.config.selectors.activeClass);

    // toggle the class on the trigger element (active = shown / nothing = not shown)
    this.$triggers[func](this.config.selectors.activeClass);

    if (this.isShown === true) {
      label = this.config.i18nStrings.close;
      expandedLabel = 'true';
      iconClass = this.config.selectors.iconClassClose;
      if (focusTarget !== false &amp;&amp; this.config.focusTarget) {
        this.$target
            .attr('tabindex', -1)
            .focus();
      }
      if (this.config.hideOnBlur) {
        this.setTargetTrackingListeners(true);
      }
    } else {
      label = this.config.i18nStrings.open;
      expandedLabel = 'false';
      iconClass = this.config.selectors.iconClassOpen;
      if (this.config.hideOnBlur) {
        this.setTargetTrackingListeners(false);
      }
    }

    this.$triggers.find('[data-dough-collapsable-label]').text(label);
    this.$triggers.attr('aria-expanded', expandedLabel);
    this.$triggers
        .find('[data-dough-collapsable-icon]')
        .removeClass(this.config.selectors.iconClassOpen + ' ' + this.config.selectors.iconClassClose).addClass(iconClass);

    // can bind to this by eventsWithPromises.subscribe('toggler:toggled', function(Collapsable) { });
    if (typeof forceTo === 'undefined') {
      eventsWithPromises.publish('toggler:toggled', {
        emitter: this,
        visible: this.isShown
      });
    }

    return this;
  };

  return Collapsable;
});
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Thu May 07 2015 15:38:12 GMT+0000 (UTC)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
